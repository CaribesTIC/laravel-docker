import{_ as s,c as a,o as n,N as o}from"./chunks/framework.b84479ea.js";const l="/vue-docker/assets/production.11466d7b.png",u=JSON.parse('{"title":"Modo Producci√≥n","description":"","frontmatter":{},"headers":[],"relativePath":"guide/production-mode.md"}'),e={name:"guide/production-mode.md"},p=o(`<h1 id="modo-produccion" tabindex="-1">Modo Producci√≥n <a class="header-anchor" href="#modo-produccion" aria-label="Permalink to &quot;Modo Producci√≥n&quot;">‚Äã</a></h1><blockquote><p><strong>¬øCu√°l es la diferecia en esta configuraci√≥n versus la versi√≥n de desarrollo?</strong></p></blockquote><h2 id="docker-compose-yml" tabindex="-1">docker-compose.yml <a class="header-anchor" href="#docker-compose-yml" aria-label="Permalink to &quot;docker-compose.yml&quot;">‚Äã</a></h2><p>üìÉ<code>docker-compose.yml</code></p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">version:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">3.9</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#FFCB6B;">services:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">web:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">build:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#FFCB6B;">context:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">.</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#FFCB6B;">dockerfile:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Dockerfile</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">ports:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#FFCB6B;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">80:80</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">environment:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#FFCB6B;">NODE_ENV:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">production</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">container_name:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">vue_dev_env</span></span></code></pre></div><ul><li>Compilaci√≥n especificada desde <code>Dockerfile</code> en lugar de usar una <code>image</code>.</li><li>La variable de entorno <code>NODE_ENV</code> cambi√≥: <code>development</code> -&gt; <code>production</code>.</li><li>No hay una secci√≥n de comandos porque <code>nginx</code> servir√° la est√°tica.</li></ul><p>La configuraci√≥n de <code>nginx</code> es lo m√°s simple posible y no sobrecarga el proceso de entrega de archivos y recurre a <code>/index.html</code> en caso de que intenten obtener alg√∫n archivo que no est√© all√≠. Lo m√°s interesante radica en el <code>Dockerfile</code>: construcci√≥n de varias etapas (<em>multi-stage</em>), que se utiliza para reducir el artefacto resultante.</p><h2 id="dockerfile" tabindex="-1">Dockerfile <a class="header-anchor" href="#dockerfile" aria-label="Permalink to &quot;Dockerfile&quot;">‚Äã</a></h2><p>üìÉ<code>Dockerfile</code></p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">FROM</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">node:18.8.0</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">AS</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">build</span></span>
<span class="line"><span style="color:#FFCB6B;">WORKDIR</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/app</span></span>
<span class="line"><span style="color:#FFCB6B;">COPY</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">package.json</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">package.json</span></span>
<span class="line"><span style="color:#FFCB6B;">RUN</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">npm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span></span>
<span class="line"><span style="color:#FFCB6B;">COPY</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">.</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">.</span></span>
<span class="line"><span style="color:#FFCB6B;">RUN</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">npm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">build</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">FROM</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx:1.23.1</span></span>
<span class="line"><span style="color:#FFCB6B;">COPY</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--from=build</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/app/dist</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/opt/site</span></span>
<span class="line"><span style="color:#FFCB6B;">COPY</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx.conf</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/etc/nginx/nginx.conf</span></span></code></pre></div><p><strong>La primera etapa es <code>build</code>.</strong></p><ol><li>Para ello, especificamos la misma imagen de origen que se utiliz√≥ para desarrollar. <code>FROM node:18.8.0 AS build</code>. ¬°Importante! Le damos a la etapa el nombre <code>build</code> para que en las siguientes etapas se llame por su nombre, y no por su √≠ndice, que puede cambiar si incluimos etapas adicionales.</li><li>Especifique el <code>WORKDIR /app</code>.</li><li><strong>Pregunta</strong>: ¬øpor qu√© primero copiamos solo <code>package.json</code> y lo instalamos? La <strong>respuesta</strong> (no se hace esperar mucho): la primera vez que ejecute la diferencia no se notar√°, pero la diferencia ser√° obvia en el pr√≥ximo intento de compilaci√≥n. Si no hubo cambios en <code>package.json</code>, las capas sobre las que se construye <em><strong>docker</strong></em> no cambiar√°n, y estos pasos simplemente se tomar√°n del <em><strong>cach√©</strong></em>. Esto acelerar√° enormemente el proceso y reducir√° varias veces la carga de la red. Solo necesitamos esto.</li><li>Copiar los archivos restantes y ejecutar la construcci√≥n.</li></ol><p><strong>La segunda etapa es la formaci√≥n de un artefacto.</strong></p><p>En esencia, un artefacto en nuestro caso es un contenedor <code>nginx</code> con est√°tica.</p><ol start="5"><li>Especificamos la imagen <code>FROM nginx:1.23.1</code> que tomaremos como base.</li><li>Copiamos los archivos desde la primera etapa a la carpeta a la que distribuiremos las est√°ticas.</li><li>Copiamos el archivo de configuraci√≥n de <code>nginx</code> en el artefacto.</li></ol><h2 id="nginx-conf" tabindex="-1">nginx.conf <a class="header-anchor" href="#nginx-conf" aria-label="Permalink to &quot;nginx.conf&quot;">‚Äã</a></h2><p>Las opciones de configuraci√≥n de NGINX se conocen como <em>‚Äúdirectivas‚Äù</em>: estas se organizan en grupos, conocidos indistintamente como bloques o contextos. Copie y pegue este archivo en la raiz del proyecto.</p><p>üìÉ<code>nginx.conf</code></p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">worker_processes</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">auto</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">events</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">worker_connections</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">8000</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">multi_accept</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">on</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">http</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">include</span><span style="color:#A6ACCD;">       </span><span style="color:#C3E88D;">/etc/nginx/mime.types</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">default_type</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">application/octet-stream</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#FFCB6B;">server</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#FFCB6B;">listen</span><span style="color:#A6ACCD;">   </span><span style="color:#F78C6C;">80</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#FFCB6B;">listen</span><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">::</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">:80 </span><span style="color:#C3E88D;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ipv6only=on</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#FFCB6B;">root</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/opt/site</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#FFCB6B;">location</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#FFCB6B;">try_files</span><span style="color:#A6ACCD;"> $uri $uri</span><span style="color:#C3E88D;">/</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/index.html</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">      }</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span></code></pre></div><h2 id="build-up" tabindex="-1">Build Up <a class="header-anchor" href="#build-up" aria-label="Permalink to &quot;Build Up&quot;">‚Äã</a></h2><p>Ahora puede ejecutar el artefacto de esta manera:</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker-compose</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">up</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-d</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--build</span></span></code></pre></div><p>Docker comenzar√° con el proceso de instaci√≥n y finalizar√° con un mensaje como el siguiente:</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">Successfully</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">built</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">5103e27c5863</span></span>
<span class="line"><span style="color:#FFCB6B;">Successfully</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">tagged</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docker-vue-example_web:latest</span></span>
<span class="line"><span style="color:#FFCB6B;">Recreating</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">vue_dev_env</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">...</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">done</span></span></code></pre></div><p>Inspeccionemos la direcci√≥n <strong>IP</strong> otorgada por <em>Docker</em> a nuestro contenedor <code>vue_dev_env</code> con el siguiente comando.</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">inspect</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">vue_dev_env</span></span></code></pre></div><p>Y deber√° aparecer al final un mensaje como este:</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">NetworkID</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">04608c48ec451acd128c224efa450d0334a7d0cccc3b14c2ec760b1d2c8bc4dc</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#89DDFF;">          &quot;</span><span style="color:#C3E88D;">EndpointID</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">32e900e38758c907bc25212e984944494957de446f5644c7799bc74c51696b9d</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#89DDFF;">          &quot;</span><span style="color:#C3E88D;">Gateway</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">192.168.32.1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#89DDFF;">          &quot;</span><span style="color:#C3E88D;">IPAddress</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">192.168.32.2</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#89DDFF;">          &quot;</span><span style="color:#C3E88D;">IPPrefixLen</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#F78C6C;">20</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#89DDFF;">          &quot;</span><span style="color:#C3E88D;">IPv6Gateway</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;"> &quot;&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#89DDFF;">          &quot;</span><span style="color:#C3E88D;">GlobalIPv6Address</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;"> &quot;&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#89DDFF;">          &quot;</span><span style="color:#C3E88D;">GlobalIPv6PrefixLen</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#89DDFF;">          &quot;</span><span style="color:#C3E88D;">MacAddress</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">02:42:c0:a8:20:02</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#89DDFF;">          &quot;</span><span style="color:#C3E88D;">DriverOpts</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: null</span></span>
<span class="line"><span style="color:#A6ACCD;">        }</span></span>
<span class="line"><span style="color:#A6ACCD;">      }</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">]</span></span></code></pre></div><p>Ok, ahora copie y pegue tal cual la direcci√≥n <strong>IP</strong> en la <strong>URL</strong> del navegador.</p><p><img src="`+l+'" alt="production"></p>',30),c=[p];function t(r,i,C,y,D,d){return n(),a("div",null,c)}const F=s(e,[["render",t]]);export{u as __pageData,F as default};
